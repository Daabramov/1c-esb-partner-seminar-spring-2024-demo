# Главное
Данный репозиторий демонстрирует пример взаимодействия конфигурации 1С и микросервиса на базе NestJS через продукт 1С.Шина.
Репозиторий сделан по итогам доклада на партнерском семинаре фирмы 1С и приглашает участников попробовать запустить все своими силами.

Документация будет обновляться, если будут вопросы пишите на https://t.me/AbramovDmitry

## Сценарий
1) Пользователи через веб портал создают заявки используя HTTP API на базе 1С.
2) Сотрудники в 1С обработывают заявку (устанавливают статус или редактируют реквизиты)
3) Пользователи веб портала через протокол WebSocket получают обновления данных заявки при ее изменении в 1С в режиме онлайн.

## Требования
1) 1С.Шина версии 4.0+
2) 1С.Предприятие 8.3.23+
3) EDT 2023.2.4+
4) NodeJs 18+

## Состав 
Репозиторий содержит 3 проекта
- Проект для 1С.Шина
- Проект конфигурации 1С в формате EDT
- Проект сервиса на базе NestJS

## Установка
1) Выполняем установку модулей NodeJS командой
```
npm install
```
2) Создаем новую базу 1С и заливаем туда конфигурацию из ЕДТ (есть много статей в интернете)
3) Делаем базу доступной на веб сервере (есть много статей в интернете)
4) Создаем новый проект в 1С.Шина из исходников в папке esb
5) Создаем новое приложение на базе проекта
6) Создаем 2 участника и добавляем их в соответствующие группы участников (источник1с и микросервис).
Сохраняем данные для входа
7) Настраиваем подключение в 1С.Шина в 1С
8) Копируем файл dev.env в .env и заполняем переменные
9) Запускаем сервис
```
nest start
```
10) Создает заявки через postman
Используем метод */hs/api/courier-tasks*
11) Запоминаем ответ из поля id
12) Создает webSocket (socket.io) подключение через постман к микросервису
13) Выполняем команду *join-room* где в теле указываем значение *task-{id}*, где подставляем значение из пункта 11
14) В 1С меняем статус заказа и запускам обработку сервисов интеграции
15) В постмане должны получить новое сообщение об изменении статуса
